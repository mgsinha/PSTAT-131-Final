---
title: "SafiyaFinalProjectScript"
author: "Safiya Alavi"
date: "10/25/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(tidyverse)
library(tidymodels)
library(corrplot)
library(ggthemes)
library(klaR) # for naive bayes
tidymodels_prefer()
```

## Overview of Data Set

<br> 

We are analyzing the quality of wine based on 11 predictors: fixed acidity, volatile acidity, citric acid, residual sugar, chlorides, free sulfur dioxide, total sulfur dioxide, density, pH, sulfates, alcohol. Quality, in this instance, is defined as an indicator of its craftsmanship and, thus, desirability which can be used, for example, in pricing. Quality does not necessarily indicate if a wine has gone bad. We will use two data sets -- one for white wine and the other for red -- to create two respective machine learning models. There are 4899 observations in the white wine data set and 1600 observations in the red wine data set. 


## Overview of Research Questions 

<br>

We are interested in conducting analysis on both the white and red wine to assess the quality of wine in new wines in production so that they may be accurately priced and marketed.  

## Proposed Project Timeline 

<br>

Week 2: Data cleaning<br>
Week 3-5: Exploratory Data Analysis<br>
Week 6-8: Model Building<br>
Week 9: Conclusion and final touches<br>

## Any questions or concerns

<br>


# Loading Data and Packages 
This project uses data on the white and red wine, which records information about the details of the wine. 

```{r load packages and data, message = FALSE}
# load packages
library(tidyverse)
library(lubridate)
library(tidymodels)
library(dplyr)

white <- read.csv("Wine Dataset/winequality-white.csv", sep = ";")

red <- read.csv("Wine Dataset/winequality-red.csv", sep = ";")

# Make Column Names Clean 
colnames(white) <- c("Fixed_Acidity", "Volatile_Acidity","Citric_Acid", "Residual_Sugar", "Chlorides", "Free_Sulfur_Dioxide", "Total_Sulfur_Dioxide", "Density", "pH", "Sulfates", "Alcohol", "Quality")
colnames(red) <- c("Fixed_Acidity", "Volatile_Acidity","Citric_Acid", "Residual_Sugar", "Chlorides", "Free_Sulfur_Dioxide", "Total_Sulfur_Dioxide", "Density", "pH", "Sulfates", "Alcohol", "Quality")

# Change quality to factor
white$Quality <- factor(white$Quality, levels = c(3,4,5,6,7,8,9))
red$Quality <- factor(red$Quality, levels = c(3,4,5,6,7,8,9))

# Adding type
white$Type <- "White"
red$Type <- "Red"

# data frame of combined wine
combinedWine <- rbind(white, red)
```


# Data Cleaning 

Our data does not need to be cleaned because it's perfect :D

# Data Split

```{r data split, message = FALSE}
white_split <- white %>% 
  initial_split(prop = 0.8, strata = "Quality")

white_train <- training(white_split)
white_test <- testing(white_split)

red_split <- red %>% 
  initial_split(prop = 0.8, strata = "Quality")

red_train <- training(red_split)
red_test <- testing(red_split)
```

## Exploratory Data Analysis

```{r eda correlation matrix, message = FALSE}
white %>% 
  select(is.numeric) %>% 
  cor() %>% 
  corrplot(type = 'lower', diag = FALSE, 
           method = 'color', main = 'White Wine Correlation Plot')

red %>% 
  select(is.numeric) %>% 
  cor() %>% 
  corrplot(type = 'lower', diag = FALSE, 
           method = 'color', main = 'Red Wine Correlation Plot')
```



```{r eda boxplot of alcohol versus quality, message = FALSE}
ggplot(white_train, aes(x = Alcohol, y = Quality)) + geom_boxplot(aes(fill = Quality))+ geom_point() + 
  labs(title = "White Wine Alcohol Content versus Quality", fill = "Quality")  +
    scale_fill_brewer(palette="BuPu")

ggplot(red_train, aes(x = Alcohol, y = Quality)) + geom_boxplot(aes(fill = Quality))+ geom_point() + 
  labs(title = "Red Wine Alcohol Content versus Quality", fill = "Quality")  +
    scale_fill_brewer(palette="RdPu")

ggplot(combinedWine, mapping = aes(x = Alcohol, y = Quality, fill = Quality)) + geom_boxplot() + geom_point(white_train, mapping = aes(x = Alcohol, y = Quality)) + labs(title = "Red and White Wine Alcohol Content versus Quality", fill = "Quality")  + scale_fill_brewer(palette="PuRd") + facet_wrap(. ~ Type, nrow = 1)

ggplot(combinedWine, mapping = aes(x = Alcohol, y = Quality, fill = Quality)) + geom_boxplot() + geom_point(white_train, mapping = aes(x = Alcohol, y = Quality)) + labs(title = "Red and White Wine Alcohol Content versus Quality", fill = "Quality")  + scale_fill_brewer(palette="OrRd") 
```

```{r eda boxplot of fixed acidity, volatile acidity, and citric acid versus quality, message = FALSE}

# FIXED ACIDITY 
# White
ggplot(white_train, aes(x = Fixed_Acidity, y = Quality)) + geom_boxplot(aes(fill = Quality))+ geom_point() + 
  labs(title = "White Wine Fixed Acidity versus Quality", fill = "Quality")  +
    scale_fill_brewer(palette="BuPu") + coord_cartesian( xlim = c(0,16), ylim = NULL, default = FALSE )

# Red
ggplot(red_train, aes(x = Fixed_Acidity, y = Quality)) + geom_boxplot(aes(fill = Quality))+ geom_point() + 
  labs(title = "Red Wine Fixed Acidity versus Quality", fill = "Quality")  +
    scale_fill_brewer(palette="RdPu") + coord_cartesian( xlim = c(0,16), ylim = NULL, default = FALSE )

# Same Page but Seperate
ggplot(combinedWine, mapping = aes(x = `Fixed_Acidity`, y = Quality, fill = Quality)) + geom_boxplot() + geom_point(white_train, mapping = aes(x = Alcohol, y = Quality)) + labs(title = "Red and White Fixed Acidity Content versus Quality", fill = "Quality")  + scale_fill_brewer(palette="PuRd") + facet_wrap(. ~ Type, nrow = 1) +coord_cartesian( xlim = c(0,16), ylim = NULL, default = FALSE )

# Combined
ggplot(combinedWine, mapping = aes(x = `Fixed_Acidity`, y = Quality, fill = Quality)) + geom_boxplot() + geom_point(white_train, mapping = aes(x = Alcohol, y = Quality)) + labs(title = "Red and White Fixed Acidity Content versus Quality", fill = "Quality")  + scale_fill_brewer(palette="PuRd")+coord_cartesian( xlim = c(0,16), ylim = NULL, default = FALSE )
# ___________________________________________________________________________
# VOLATILE ACIDITY 
# White
ggplot(white_train, aes(x = `Volatile_Acidity`, y = Quality)) + geom_boxplot(aes(fill = Quality))+ geom_point() + 
  labs(title = "White Wine Volatile Acidity versus Quality", fill = "Quality")  + scale_fill_brewer(palette="BuPu")+ coord_cartesian( xlim = c(0,1), ylim = NULL, default = FALSE )

# Red
ggplot(red_train, aes(x = `Volatile_Acidity`, y = Quality)) + geom_boxplot(aes(fill = Quality))+ geom_point() + 
  labs(title = "Red Wine Volatile_Acidity versus Quality", fill = "Quality")  +
    scale_fill_brewer(palette="RdPu") + coord_cartesian( xlim = c(0,1), ylim = NULL, default = FALSE )

# Same Page but Seperate
ggplot(combinedWine, mapping = aes(x = `Volatile_Acidity`, y = Quality, fill = Quality)) + geom_boxplot() + geom_point(white_train, mapping = aes(x = Alcohol, y = Quality)) + labs(title = "Red and White Volatile_Acidity Content versus Quality", fill = "Quality")  + scale_fill_brewer(palette="PuRd") + facet_wrap(. ~ Type, nrow = 1) + coord_cartesian( xlim = c(0,1), ylim = NULL, default = FALSE )

# Combined
ggplot(combinedWine, mapping = aes(x = `Volatile_Acidity`, y = Quality, fill = Quality)) + geom_boxplot() + geom_point(white_train, mapping = aes(x = Alcohol, y = Quality)) + labs(title = "Red and White Volatile_Acidity Content versus Quality", fill = "Quality")  + scale_fill_brewer(palette="PuRd") +coord_cartesian( xlim = c(0,1), ylim = NULL, default = FALSE )

# ___________________________________________________________________________
# CITRIC ACID 
# White
ggplot(white_train, aes(x = `Citric_Acid`, y = Quality)) + geom_boxplot(aes(fill = Quality))+ geom_point() + 
  labs(title = "White Wine Citric Acid Levels versus Quality", fill = "Quality")  + scale_fill_brewer(palette="BuPu")

# Red
ggplot(red_train, aes(x = `Citric_Acid`, y = Quality)) + geom_boxplot(aes(fill = Quality))+ geom_point() + 
  labs(title = "Red Wine Citric Acid Levels versus Quality", fill = "Quality")  + scale_fill_brewer(palette="RdPu")

# Same Page but Separate (Cut off at 1)
ggplot(combinedWine, mapping = aes(x = `Citric_Acid`, y = Quality, fill = Quality)) + geom_boxplot() + geom_point(white_train, mapping = aes(x = Alcohol, y = Quality)) + labs(title = "Red and White Citric Acid Levels Content versus Quality", fill = "Quality")  + scale_fill_brewer(palette="PuRd") + facet_wrap(. ~ Type, nrow = 1)+ coord_cartesian( xlim = c(0,1), ylim = NULL, default = FALSE )

# Combined
ggplot(combinedWine, mapping = aes(x = `Citric_Acid`, y = Quality, fill = Quality)) + geom_boxplot() + geom_point(white_train, mapping = aes(x = Alcohol, y = Quality)) + labs(title = "Red and White Citric Acid Levels Content versus Quality", fill = "Quality")  + scale_fill_brewer(palette="PuRd")+ coord_cartesian( xlim = c(0,1), ylim = NULL, default = FALSE )
```


## Model Fitting
```{r creating recipe}
# creating recipe 
white_recipe <- recipe(Quality ~ Fixed_Acidity + Volatile_Acidity + Citric_Acid + Residual_Sugar + Chlorides + Free_Sulfur_Dioxide + Total_Sulfur_Dioxide + Density + pH + Sulfates + Alcohol, data = white_train) %>% step_dummy(all_nominal_predictors()) %>% step_interact(~ ends_with("Acidity"):Citric_Acid + Fixed_Acidity:Density + Fixed_Acidity:pH + Free_Sulfur_Dioxide:Total_Sulfur_Dioxide)

red_recipe <- recipe(Quality ~ Fixed_Acidity + Volatile_Acidity + Citric_Acid + Residual_Sugar + Chlorides + Free_Sulfur_Dioxide + Total_Sulfur_Dioxide + Density + pH + Sulfates + Alcohol, data = red_train) %>% step_dummy(all_nominal_predictors()) %>% step_interact(~ ends_with("Acidity"):Citric_Acid + Fixed_Acidity:Density + Fixed_Acidity:pH + Free_Sulfur_Dioxide:Total_Sulfur_Dioxide)
```

```{r log reg}

# white wine
wlog_model <- logistic_reg() %>% 
  set_engine("glm") %>% set_mode("classification")

wlog_wkflow <- workflow() %>% 
  add_model(wlog_model) %>% 
  add_recipe(white_recipe)

wlog_reg_fit <- fit(wlog_wkflow, white_train)


# red wine
rlog_model <- logistic_reg() %>% 
  set_engine("glm") %>% set_mode("classification")

rlog_wkflow <- workflow() %>% 
  add_model(rlog_model) %>% 
  add_recipe(red_recipe)

rlog_reg_fit <- fit(rlog_wkflow, red_train)

wlog_reg_res <- predict(wlog_reg_fit, new_data = white_test %>%  select(-Quality), type = "class" ) 

wlog_reg_res <- bind_cols(wlog_reg_res, white_test %>%  select(Quality)) 

wlog_reg_acc <- augment(wlog_reg_fit, new_data = white_test) %>% accuracy(truth = Quality, estimate = .pred_class)

print(wlog_reg_res)
print(wlog_reg_acc)

#collect_metrics(wlog_reg_fit)
#collect_metrics(rlog_reg_fit)
```
```{r Naive Bayes model}
# specifying the naive Bayes model using the mass engine
wnb_mod <- naive_Bayes() %>% 
  set_mode("classification") %>% 
  set_engine("klaR") %>% 
  set_args(usekernel = FALSE) 

wnb_wkflow <- workflow() %>% 
  add_model(wnb_mod) %>% 
  add_recipe(white_recipe)

nb_fit_white <- fit(wnb_wkflow, white_train)
```
